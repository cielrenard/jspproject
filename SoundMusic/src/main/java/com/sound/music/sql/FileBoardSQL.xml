<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
				"-//mybatis.org//DTD Mapper 3.0//EN" 
				"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
				
<!-- #{키값}
	키값은 해당 질의문을 실행할 때 알려줘야하는 데이터이다
	
	-데이터를 알려주는 방법
	1) 데이터가 한 		개인 경우
		=> 일반 자바 형태로 알려주면 된다
	2) 데이터가 여러	개인 경우 
		=> VO, Map으로 데이터를 묶어서 알려주면 된다
		
	-질의문에 필요한 속성
	1) parameterType
		=> 질의문을 실행할 때 필요한 데이터를
			어떤 형태로 입력할지를 지정하는 부분
	2) resultType
		=> 질의문을 실행했을 때 얻어지는 데이터를 
			어떤 형태로 받을지를 지정하는 부분
			
	참고
		데이터의 형태를 지정할 때에는 반드시 풀경로로 작성해야 한다 
		예) String은 java.lang.String
			int는 	java.lnag.Integer
 -->
 
<mapper namespace="fileBoard">
<!-- 해당 페이지에 보여줄 게시물 정보 구하기 질의 -->
<select id="boardList" resultType="fileBoard" parameterType="fileBoard">
select
    *
from
    (
    select
    fb_No    AS NO,
    fb_Writer    AS ID,
    m_nick AS Nick,
    fb_Title    AS TITLE,
    fb_Date    AS WDAY,
    fb_Hit    AS HIT,
    ROW_NUMBER() OVER(ORDER BY fb_NO DESC) as rno,
    nvl(t1.cnt,0) AS FILECOUNT
from
    fileboard,member,
    (select
    count(*) as cnt,
    fi_orino
    from
    fileinfo
    group by
    fi_orino) t1
where 
    fb_no=t1.fi_orino(+) and 
    upper(fb_isshow)='Y' and
    fb_Writer = m_id
    )
where
    rno between #{start} and #{end}

</select>
 <!-- 게시물 개수 구하기 -->
 	<select id="totalcount" resultType="int">
 		
		SELECT 
			COUNT (*) AS CNT
		FROM
			FILEBOARD
		WHERE
			Upper(fb_isshow)='Y'
 	</select>
	<!-- 게시물 등록 -->
	<insert id="insertBoard" parameterType="fileBoard">
	<!-- insert(메인질의) 실행하기 전에 selectKey(보조질의)부터 실행 -->
	<selectKey order="BEFORE" resultType="int" keyProperty="no">
	SELECT
		NVL(MAX(fb_No),0)+1
	FROM
		FileBoard	
	</selectKey>
	
	INSERT INTO 
		FileBoard
 	VALUES(#{no},#{id},#{title},#{body},SYSDATE,#{pw},0,'Y')
	</insert>
	<!-- 업로드된 파일 정보 등록 질의문 -->
	<insert id="insertFileInfo" parameterType="fileBoard">
 	INSERT INTO
		FileInfo
 	VALUES(
		(SELECT NVL (MAX(fi_No),0)+1 FROM FileInfo),
		#{oriNo},
		#{path},
		#{oriName},
		#{saveName},
		#{len})	
	</insert>
	
</mapper>